<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸æ“šè¿½è¹¤ - å€‹äººå¥èº«è¿½è¹¤å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background-color: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #1a237e; }
        h1, h2 { border-bottom: 2px solid #3f51b5; padding-bottom: 10px; margin-top: 20px; }
        h1 { margin-top: 0; }
        nav { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 5px; }
        nav a { text-decoration: none; flex-grow: 1; padding: 10px 15px; border: none; background-color: #e8eaf6; color: #3f51b5; cursor: pointer; border-radius: 5px; font-size: 16px; transition: background-color 0.3s; text-align: center; }
        nav a.active { background-color: #3f51b5; color: white; font-weight: bold; }
        
        /* --- âœ… MODIFIED COUNTDOWN STYLES --- */
        #countdown-container {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        #countdown-container h2 {
            margin-top: 0;
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
            font-size: 1.5em;
        }
        .progress-track {
            position: relative; /* é—œéµï¼šè®“åœ–ç¤ºå¯ä»¥å®šä½åœ¨å®ƒä¸Šé¢ */
            background-color: #e0e0e0;
            border-radius: 15px;
            height: 25px;
            margin-top: 20px;
            border: 1px solid #ccc;
            overflow: hidden;
        }
        .time-bar {
            background-color: #4caf50; /* æ™‚é–“é€²åº¦çš„åº•è‰² */
            height: 100%;
            width: 0%; /* JSæ§åˆ¶ */
            transition: width 0.5s ease-in-out;
        }
        .weight-icon {
            position: absolute; /* é—œéµï¼šè®“åœ–ç¤ºæµ®å‹• */
            top: 50%;
            left: 0%; /* JSæ§åˆ¶ */
            transform: translate(-50%, -50%); /* è®“åœ–ç¤ºçš„ä¸­å¿ƒé»å°æº– left çš„ç™¾åˆ†æ¯”ä½ç½® */
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: left 0.5s ease-in-out;
        }
        .progress-details {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            color: #555;
            padding: 0 5px;
        }
        /* --- END MODIFIED STYLES --- */

        #data-entry-form { background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .form-row { display: flex; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .form-row:last-child { margin-bottom: 0; }
        .form-row label { font-weight: bold; margin-right: -5px; }
        .form-row input[type="date"], .form-row input[type="number"], .form-row input[type="text"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .form-row input[type="number"] { flex: 1; min-width: 100px; }
        .radio-group { display: flex; align-items: center; gap: 15px; margin-left: 10px; }
        .button-row { justify-content: flex-end; }
        button { padding: 10px 20px; border: none; background-color: #4caf50; color: white; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #45a049; }
        #chart-controls { margin: 20px 0; display: flex; align-items: center; flex-wrap: wrap; }
        #chart-controls button { background-color: #9fa8da; margin-right: 5px; margin-bottom: 5px; }
        #chart-controls button.active { background-color: #5c6bc0; }
        canvas { margin-top: 20px; border-radius: 8px; }
        #raw-data-table-container { margin-top: 30px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; }
        #raw-data-table { width: 100%; border-collapse: collapse; }
        #raw-data-table th, #raw-data-table td { padding: 10px 15px; text-align: left; border-bottom: 1px solid #eee; }
        #raw-data-table th { background-color: #e8eaf6; color: #3f51b5; font-weight: bold; position: sticky; top: 0; z-index: 1; }
        #raw-data-table td button { background-color: #2196f3; margin-right: 5px; padding: 6px 10px; font-size: 12px; }
        #raw-data-table td button.delete-btn { background-color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>å€‹äººå¥èº«è¿½è¹¤å™¨</h1>
        <nav>
            <a href="index.html" class="active">æ•¸æ“šè¿½è¹¤</a>
            <a href="workout.html">ä»Šæ—¥èª²è¡¨</a>
            <a href="diet.html">é£²é£Ÿç´€éŒ„</a>
        </nav>

        <div id="countdown-container">
            </div>

        <div id="page-tracker">
            <h2>æ•¸æ“šè¼¸å…¥</h2>
            <div id="data-entry-form"> </div>
            <div id="chart-controls"> </div>
            <h2>é«”é‡è¶¨å‹¢</h2>
            <canvas id="weightChart"></canvas>
            <h2>é«”è„‚è¶¨å‹¢</h2>
            <canvas id="bodyfatChart"></canvas>
            <h2>éª¨éª¼è‚Œè¶¨å‹¢</h2>
            <canvas id="muscleMassChart"></canvas>
            <h2>åŸå§‹æ•¸æ“š (RAW Data)</h2>
            <div id="raw-data-table-container"> </div>
        </div>
    </div>

<script>
    let weightChart, bodyfatChart, muscleMassChart;
    let fitnessData = JSON.parse(localStorage.getItem('fitnessData')) || [];

    function addData() {
        // ... (addData å‡½æ•¸ä¸è®Š) ...
        renderCountdown(); // æ–°å¢æ•¸æ“šå¾Œï¼Œé‡æ–°æ¸²æŸ“å€’æ•¸è¨ˆæ™‚å™¨
    }
    
    function saveFitnessData() {
        localStorage.setItem('fitnessData', JSON.stringify(fitnessData));
    }
    
    // ... (æ‰€æœ‰åœ–è¡¨å’Œè¡¨æ ¼çš„JSå‡½æ•¸éƒ½ä¿æŒä¸è®Š) ...


    // --- âœ… MODIFIED JAVASCRIPT: ç™¾æ—¥å€’æ•¸åŠŸèƒ½ ---
    function renderCountdown() {
        const CHALLENGE_START_DATE_STRING = '2025-10-20'; 
        const CHALLENGE_DURATION = 100;
        const TARGET_WEIGHT = 75.0;

        const container = document.getElementById('countdown-container');
        const MS_PER_DAY = 1000 * 60 * 60 * 24;

        // 1. è™•ç†æ—¥æœŸ
        const startDate = new Date(CHALLENGE_START_DATE_STRING + 'T00:00:00');
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const daysPassed = Math.round((today - startDate) / MS_PER_DAY);
        let timePercentage = (daysPassed / CHALLENGE_DURATION) * 100;

        let title = "ç™¾æ—¥æ¸›é‡æŒ‘æˆ°";
        if (daysPassed < 0) {
            title = `æŒ‘æˆ°å°‡æ–¼ ${CHALLENGE_START_DATE_STRING} é–‹å§‹ï¼`;
            timePercentage = 0;
        } else if (daysPassed > CHALLENGE_DURATION) {
            title = "ç™¾æ—¥æŒ‘æˆ°å·²çµæŸï¼";
            timePercentage = 100;
        }

        // 2. è™•ç†é«”é‡æ•¸æ“š
        let startWeight = null;
        let currentWeight = null;
        
        const startEntry = fitnessData.find(entry => new Date(entry.date) >= new Date(CHALLENGE_START_DATE_STRING));
        if (startEntry) {
            startWeight = startEntry.weight;
        }
        if (fitnessData.length > 0) {
            currentWeight = fitnessData[fitnessData.length - 1].weight;
        }

        // 3. è¨ˆç®—é«”é‡é€²åº¦
        let weightPercentage = 0;
        let startWeightDisplay = startWeight ? `${startWeight.toFixed(1)}kg` : "N/A";
        let currentWeightDisplay = currentWeight ? `${currentWeight.toFixed(1)}kg` : "N/A";
        
        if (startWeight && currentWeight && startWeight > TARGET_WEIGHT) {
            const totalToLose = startWeight - TARGET_WEIGHT;
            const lostSoFar = startWeight - currentWeight;
            weightPercentage = (lostSoFar / totalToLose) * 100;
        } else if (startWeight && currentWeight && currentWeight <= TARGET_WEIGHT) {
            weightPercentage = 100;
        }
        
        timePercentage = Math.max(0, Math.min(100, timePercentage));
        weightPercentage = Math.max(0, Math.min(100, weightPercentage));

        // 4. ç”¢ç”Ÿæ–°çš„ HTML çµæ§‹
        container.innerHTML = `
            <h2>${title}</h2>
            
            <div class="progress-track">
                <div class="time-bar" style="width: ${timePercentage.toFixed(0)}%;"></div>
                <div class="weight-icon" style="left: ${weightPercentage.toFixed(0)}%;">ğŸƒ</div>
            </div>

            <div class="progress-details">
                <span>æ™‚é–“: ç¬¬ ${Math.max(0, daysPassed)} / ${CHALLENGE_DURATION} å¤©</span>
                <span>é«”é‡: ${startWeightDisplay} â†’ ${currentWeightDisplay} (ç›®æ¨™ ${TARGET_WEIGHT.toFixed(1)}kg)</span>
            </div>
        `;
    }
    // --- END MODIFIED JAVASCRIPT ---

    document.addEventListener('DOMContentLoaded', () => {
        // ... (é é¢è¼‰å…¥æ™‚çš„å…¶ä»–å‡½æ•¸ä¸è®Š) ...
        renderCountdown(); // é é¢è¼‰å…¥æ™‚åŸ·è¡Œä¸€æ¬¡
    });
</script>
</body>
</html>
