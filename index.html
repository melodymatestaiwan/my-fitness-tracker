<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>數據追蹤 - 個人健身追蹤器</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background-color: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #1a237e; }
        h1, h2 { border-bottom: 2px solid #3f51b5; padding-bottom: 10px; margin-top: 20px; }
        h1 { margin-top: 0; }
        nav { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 5px; }
        nav a { text-decoration: none; flex-grow: 1; padding: 10px 15px; border: none; background-color: #e8eaf6; color: #3f51b5; cursor: pointer; border-radius: 5px; font-size: 16px; transition: background-color 0.3s; text-align: center; }
        nav a.active { background-color: #3f51b5; color: white; font-weight: bold; }
        
        /* --- ✅ MODIFIED COUNTDOWN STYLES --- */
        #countdown-container {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        #countdown-container h2 {
            margin-top: 0;
            text-align: center;
            border-bottom: none;
            padding-bottom: 0;
            font-size: 1.5em;
        }
        .progress-track {
            position: relative; /* 關鍵：讓圖示可以定位在它上面 */
            background-color: #e0e0e0;
            border-radius: 15px;
            height: 25px;
            margin-top: 20px;
            border: 1px solid #ccc;
            overflow: hidden;
        }
        .time-bar {
            background-color: #4caf50; /* 時間進度的底色 */
            height: 100%;
            width: 0%; /* JS控制 */
            transition: width 0.5s ease-in-out;
        }
        .weight-icon {
            position: absolute; /* 關鍵：讓圖示浮動 */
            top: 50%;
            left: 0%; /* JS控制 */
            transform: translate(-50%, -50%); /* 讓圖示的中心點對準 left 的百分比位置 */
            width: 32px;
            height: 32px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: left 0.5s ease-in-out;
        }
        .progress-details {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9em;
            color: #555;
            padding: 0 5px;
        }
        /* --- END MODIFIED STYLES --- */

        #data-entry-form { background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .form-row { display: flex; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .form-row:last-child { margin-bottom: 0; }
        .form-row label { font-weight: bold; margin-right: -5px; }
        .form-row input[type="date"], .form-row input[type="number"], .form-row input[type="text"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .form-row input[type="number"] { flex: 1; min-width: 100px; }
        .radio-group { display: flex; align-items: center; gap: 15px; margin-left: 10px; }
        .button-row { justify-content: flex-end; }
        button { padding: 10px 20px; border: none; background-color: #4caf50; color: white; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #45a049; }
        #chart-controls { margin: 20px 0; display: flex; align-items: center; flex-wrap: wrap; }
        #chart-controls button { background-color: #9fa8da; margin-right: 5px; margin-bottom: 5px; }
        #chart-controls button.active { background-color: #5c6bc0; }
        canvas { margin-top: 20px; border-radius: 8px; }
        #raw-data-table-container { margin-top: 30px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; }
        #raw-data-table { width: 100%; border-collapse: collapse; }
        #raw-data-table th, #raw-data-table td { padding: 10px 15px; text-align: left; border-bottom: 1px solid #eee; }
        #raw-data-table th { background-color: #e8eaf6; color: #3f51b5; font-weight: bold; position: sticky; top: 0; z-index: 1; }
        #raw-data-table td button { background-color: #2196f3; margin-right: 5px; padding: 6px 10px; font-size: 12px; }
        #raw-data-table td button.delete-btn { background-color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>個人健身追蹤器</h1>
        <nav>
            <a href="index.html" class="active">數據追蹤</a>
            <a href="workout.html">今日課表</a>
            <a href="diet.html">飲食紀錄</a>
        </nav>

        <div id="countdown-container">
            </div>

        <div id="page-tracker">
            <h2>數據輸入</h2>
            <div id="data-entry-form"> </div>
            <div id="chart-controls"> </div>
            <h2>體重趨勢</h2>
            <canvas id="weightChart"></canvas>
            <h2>體脂趨勢</h2>
            <canvas id="bodyfatChart"></canvas>
            <h2>骨骼肌趨勢</h2>
            <canvas id="muscleMassChart"></canvas>
            <h2>原始數據 (RAW Data)</h2>
            <div id="raw-data-table-container"> </div>
        </div>
    </div>

<script>
    let weightChart, bodyfatChart, muscleMassChart;
    let fitnessData = JSON.parse(localStorage.getItem('fitnessData')) || [];

    function addData() {
        // ... (addData 函數不變) ...
        renderCountdown(); // 新增數據後，重新渲染倒數計時器
    }
    
    function saveFitnessData() {
        localStorage.setItem('fitnessData', JSON.stringify(fitnessData));
    }
    
    // ... (所有圖表和表格的JS函數都保持不變) ...


    // --- ✅ MODIFIED JAVASCRIPT: 百日倒數功能 ---
    function renderCountdown() {
        const CHALLENGE_START_DATE_STRING = '2025-10-20'; 
        const CHALLENGE_DURATION = 100;
        const TARGET_WEIGHT = 75.0;

        const container = document.getElementById('countdown-container');
        const MS_PER_DAY = 1000 * 60 * 60 * 24;

        // 1. 處理日期
        const startDate = new Date(CHALLENGE_START_DATE_STRING + 'T00:00:00');
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const daysPassed = Math.round((today - startDate) / MS_PER_DAY);
        let timePercentage = (daysPassed / CHALLENGE_DURATION) * 100;

        let title = "百日減重挑戰";
        if (daysPassed < 0) {
            title = `挑戰將於 ${CHALLENGE_START_DATE_STRING} 開始！`;
            timePercentage = 0;
        } else if (daysPassed > CHALLENGE_DURATION) {
            title = "百日挑戰已結束！";
            timePercentage = 100;
        }

        // 2. 處理體重數據
        let startWeight = null;
        let currentWeight = null;
        
        const startEntry = fitnessData.find(entry => new Date(entry.date) >= new Date(CHALLENGE_START_DATE_STRING));
        if (startEntry) {
            startWeight = startEntry.weight;
        }
        if (fitnessData.length > 0) {
            currentWeight = fitnessData[fitnessData.length - 1].weight;
        }

        // 3. 計算體重進度
        let weightPercentage = 0;
        let startWeightDisplay = startWeight ? `${startWeight.toFixed(1)}kg` : "N/A";
        let currentWeightDisplay = currentWeight ? `${currentWeight.toFixed(1)}kg` : "N/A";
        
        if (startWeight && currentWeight && startWeight > TARGET_WEIGHT) {
            const totalToLose = startWeight - TARGET_WEIGHT;
            const lostSoFar = startWeight - currentWeight;
            weightPercentage = (lostSoFar / totalToLose) * 100;
        } else if (startWeight && currentWeight && currentWeight <= TARGET_WEIGHT) {
            weightPercentage = 100;
        }
        
        timePercentage = Math.max(0, Math.min(100, timePercentage));
        weightPercentage = Math.max(0, Math.min(100, weightPercentage));

        // 4. 產生新的 HTML 結構
        container.innerHTML = `
            <h2>${title}</h2>
            
            <div class="progress-track">
                <div class="time-bar" style="width: ${timePercentage.toFixed(0)}%;"></div>
                <div class="weight-icon" style="left: ${weightPercentage.toFixed(0)}%;">🏃</div>
            </div>

            <div class="progress-details">
                <span>時間: 第 ${Math.max(0, daysPassed)} / ${CHALLENGE_DURATION} 天</span>
                <span>體重: ${startWeightDisplay} → ${currentWeightDisplay} (目標 ${TARGET_WEIGHT.toFixed(1)}kg)</span>
            </div>
        `;
    }
    // --- END MODIFIED JAVASCRIPT ---

    document.addEventListener('DOMContentLoaded', () => {
        // ... (頁面載入時的其他函數不變) ...
        renderCountdown(); // 頁面載入時執行一次
    });
</script>
</body>
</html>
